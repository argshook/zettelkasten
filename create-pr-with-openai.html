<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Turbocharging GitHub PR Creation with Python, OpenAI, and GitHub CLI | arij.us</title>
    <link rel="stylesheet" href="/statics/style.css" />
    <link rel="icon" href="/statics/favicon.png" type="image/x-icon" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="https://arij.us" class="site-title">
          <img class="site-logo" src="/statics/favicon.png" alt="" width="32" height="32" />
          <span>arij.us</span>
          <p class="site-subtitle">Digital Garden</p>
        </a>

        <nav class="site-nav">
          <ul id="main-menu">
            <li><a href="https://arij.us">Home</a></li>
            <li><a href="https://arij.us/about.html">About</a></li>
            <li><a href="https://arij.us/projects.html">Projects</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main id="main-content" class="container">
      <article>
        <h1 id="title" class="article-title">Turbocharging GitHub PR Creation with Python, OpenAI, and GitHub CLI</h1>
        <p>Developers who push numerous PRs daily can understand the taxing effort it takes to consistently pull-off comprehensive titles and descriptions. After writing great commit messages there should be no need to again write the PR description - it’s essentially the same thing in a different format.</p>
<p>I decided to automate the process of creating PRs. Not only pushing code with <code>gh pr create</code>, but also generating values for title and description.</p>
<p>Using <code>python</code> as a glue to combine Git, GitHub CLI (<code>gh</code>), and OpenAI’s API, I ended up with a simple script.</p>
<p>I chose to put it as <code>,pr-create</code> command. The comma (<code>,</code>) is just to make sure my script does not clash with some other command.</p>
<h2 id="script-overview">Script Overview</h2>
<p>The complete script is <a href="https://github.com/argshook/dotfiles/blob/master/.argsdotfiles/bin/%2Cpr-create">here in my dotfiles</a>.</p>
<p>If you want to use it, make sure <code>openai</code> and <code>yaspin</code> python modules are available. This can be done with a quick <code>pip install openai yaspin</code></p>
<p><code>openai</code> is used to receive completion from <a href="https://openai.com/">OpenAI</a> API and <code>yaspin</code> is for a spinner to indicate progress. Just because I wanted a few sparks in my terminal. Adjust to fit your use case!</p>
<p>My script does 3 things:</p>
<ol type="1">
<li>Extracts the git log.</li>
<li>Summarizes the changes into a clear, concise title and description using OpenAI’s <code>gpt-3.5-turbo</code> model.</li>
<li>Pushes a PR to GitHub using <a href="https://cli.github.com/"><code>gh cli</code></a> with the generated title and description.</li>
</ol>
<h3 id="extracting-the-git-log">Extracting the Git Log</h3>
<p>To obtain a history of changes, we first need to determine the base commit from which the current branch diverged. This can be done using the <code>git merge-base</code> command:</p>
<pre class="python"><code>base_commit = subprocess.check_output(
    &quot;git merge-base HEAD $(git show-ref --verify --quiet refs/heads/main &amp;&amp; echo &#39;main&#39; || echo &#39;master&#39;)&quot;,
    shell=True,
    universal_newlines=True
).strip()</code></pre>
<p>Once we have <code>base_commit</code>, then we use it in <code>git log --pretty</code> to retrieve and format the log:</p>
<pre class="python"><code>output = subprocess.check_output(
    f&#39;git log --reverse --pretty=format:&quot;* %s%n%w(0,4,4)%b&quot; {base_commit}..HEAD&#39;,
    shell=True,
    universal_newlines=True
)</code></pre>
<p>This command also formats each commit as a list item, ensuring commit messages and bodies are properly indented.</p>
<h3 id="generating-the-title-and-description-with-openai">Generating the Title and Description with OpenAI</h3>
<p>The OpenAI <code>gpt-3.5-turbo</code> model is then used to generate a human-friendly title and description based on the git log. Using OpenAI API is a breeze with the official <code>openai</code> python module:</p>
<pre class="python"><code>response = openai.ChatCompletion.create(
    model=&#39;gpt-3.5-turbo&#39;,
    temperature=0.2,
    n=1,
    messages=[{&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: prompt}]
)
output = response.choices[0].message.content.strip().strip(&#39;&quot;&#39;)</code></pre>
<p>Here, <code>prompt</code> is a string that instructs to generate a PR title or description from the git log. For instance, a <code>prompt</code> for the title might look like this:</p>
<pre class="python"><code>prompt = f&quot;You are an expert software engineer preparing the title of a PR. Summarize key changes into a short (max 100 chars) PR title from git log:\n\n{log}&quot;</code></pre>
<p>Here <code>log</code> is the git log obtained in the previous step.</p>
<h3 id="creating-the-pull-request">Creating the Pull Request</h3>
<p>Finally, we combine generated title and description to create a command for GitHub CLI to create the PR:</p>
<pre class="python"><code>command = f&#39;gh pr create --assignee @me --title {title} --body {body}&#39;</code></pre>
<p>Eventually this command is executed in the shell, creating the PR.</p>
<h2 id="conclusion">Conclusion</h2>
<p>By combining Python, OpenAI, and GitHub CLI, I now have a great tool to speed up PR creation. Once i’m ready to push changes to GitHub, all is needed is to run <code>,pr-create</code>.</p>
<p>After typing hundreds of PR titles and descriptions, this little trick feels like an incredible time saver.</p>
<p>Granted, titles and descriptions aren’t always on-point. Nonetheless, it’s much easier to quickly edit a few logic mistakes in text instead of starting from empty text field.</p>
<p>If you’d like to use or further explore this script, you can find the complete version <a href="https://github.com/argshook/dotfiles/blob/master/.argsdotfiles/bin/%2Cpr-create">here in my dotfiles repo</a>.</p>         <p class="article-meta">Last updated: 2023-07-24</p>
              </article>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div>
          <p>&copy; 2023 Arijus Šukys</p>

          <a href="https://x.com/argshook" title="Arijus Šukys on X.com">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 16 16"
              fill="none"
              stroke="none"
              width="16"
              height="16"
              class="w-6 h-6"
            >
              <path
                fill="currentColor"
                d="M12.6009 0.903908H15.0544L9.69434 7.03008L16 15.3664H11.0627L7.19566 10.3105L2.77087 15.3664H0.31595L6.04904 8.81379L0 0.903908H5.06262L8.55811 5.52524L12.6009 0.903908ZM11.7399 13.8979H13.0993L4.32392 2.29528H2.86506L11.7399 13.8979Z"
              ></path>
            </svg>
          </a>

          <a href="https://github.com/argshook" title="Arijus Šukys on GitHub">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              width="16"
              height="16"
            >
              <path
                fill="currentColor"
                d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
              />
            </svg>
          </a>

          <a
            href="https://linkedin.com/arijus"
            title="Arijus Šukys on LinkedIn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 310 310"
              width="16"
              height="16"
              fill="currentColor"
            >
              <path
                d="M72.16,99.73H9.927c-2.762,0-5,2.239-5,5v199.928c0,2.762,2.238,5,5,5H72.16c2.762,0,5-2.238,5-5V104.73
		C77.16,101.969,74.922,99.73,72.16,99.73z"
              />
              <path
                d="M41.066,0.341C18.422,0.341,0,18.743,0,41.362C0,63.991,18.422,82.4,41.066,82.4
		c22.626,0,41.033-18.41,41.033-41.038C82.1,18.743,63.692,0.341,41.066,0.341z"
              />
              <path
                d="M230.454,94.761c-24.995,0-43.472,10.745-54.679,22.954V104.73c0-2.761-2.238-5-5-5h-59.599
		c-2.762,0-5,2.239-5,5v199.928c0,2.762,2.238,5,5,5h62.097c2.762,0,5-2.238,5-5v-98.918c0-33.333,9.054-46.319,32.29-46.319
		c25.306,0,27.317,20.818,27.317,48.034v97.204c0,2.762,2.238,5,5,5H305c2.762,0,5-2.238,5-5V194.995
		C310,145.43,300.549,94.761,230.454,94.761z"
              />
            </svg>
          </a>
        </div>

        <button class="theme-toggle" aria-label="Toggle dark theme">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
      </div>
    </footer>

    <script>
      // Toggle dark theme
      document
        .querySelector(".theme-toggle")
        .addEventListener("click", function () {
          document.body.classList.toggle("dark-theme");
          localStorage.setItem(
            "theme",
            document.body.classList.contains("dark-theme") ? "dark" : "light"
          );
        });

      // Check for saved theme preference or respect OS preference
      const savedTheme = localStorage.getItem("theme");
      const prefersDark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
        document.body.classList.add("dark-theme");
      }
    </script>
  </body>
</html>
